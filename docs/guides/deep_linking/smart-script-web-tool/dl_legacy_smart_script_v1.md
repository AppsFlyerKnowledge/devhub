---
title: "[Legacy] OneLink Smart Script V1"
slug: "dl_legacy_smart_script_v1"
category: 6384c30e5a754e005f668a74
parentDoc: 63ad67e32f0483001e26406b
hidden: false
createdAt: "2022-12-29T10:12:33.092Z"
updatedAt: "2022-12-29T10:34:49.126Z"
---
**At a glance**: Customize OneLinks that are automatically generated and embedded behind a button or banner on your brand's website. **Note**: Although not mandatory, consider migrating to [OneLink Smart Script V2](https://dev.appsflyer.com/hc/docs/onelink-smart-script-v2web-to-app-url-generator). 
[block:image]
{
  "images": [
    {
      "image": [
        "https://files.readme.io/2b7e970-7901_Smart_Script_flow_1920x1080_2_1.png",
        "7901 Smart Script flow 1920x1080 2 (1).png",
        1920,
        1080,
        "#ecf2f8"
      ]
    }
  ]
}
[/block]

[block:embed]
{
  "html": "<iframe class=\"embedly-embed\" src=\"//cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Ffast.wistia.net%2Fembed%2Fiframe%2Fpeqytyburo&display_name=Wistia%2C+Inc.&url=https%3A%2F%2Fappsflyer.wistia.com%2Fmedias%2Fpeqytyburo&image=https%3A%2F%2Fembed-ssl.wistia.com%2Fdeliveries%2F446f0c0ae9fe8b40f83c9151d39cdd7f.jpg%3Fimage_crop_resized%3D960x540&key=f2aa6fc3595946d0afc3d76cbbd25dc3&type=text%2Fhtml&schema=wistia\" width=\"960\" height=\"540\" scrolling=\"no\" title=\"Wistia, Inc. embed\" frameborder=\"0\" allow=\"autoplay; fullscreen\" allowfullscreen=\"true\"></iframe>",
  "url": "https://appsflyer.wistia.com/medias/peqytyburo",
  "title": "OneLink_Smart_Script_Tech deep dive [Q4 2020]",
  "favicon": "https://appsflyer.wistia.com/favicon.ico",
  "image": "https://embed-ssl.wistia.com/deliveries/446f0c0ae9fe8b40f83c9151d39cdd7f.jpg?image_crop_resized=960x540"
}
[/block]

[block:api-header]
{
  "title": "About OneLink Smart Script"
}
[/block]
Users arrive at your mobile website before reaching your app store page, either organically, or via advertising campaigns. However, since there are two clicks (the first that directs to the web page and the second that directs from the web page to the app store), collecting click conversion metrics and deep linking is problematic. 

OneLink Smart Script solves these problems. The script:

- Uses the incoming URLs leading to the webpage to automatically generate unique outgoing OneLink URLs leading to the app store. 
- Provides accurate web-to-app metrics collection for all media sources. 
- Can be used for deep linking. 
- Runs seamlessly on any webpage or landing page.
[block:api-header]
{
  "title": "Procedures"
}
[/block]
To set up the Smart Script, the following action checklist of procedures need to be completed. 
[block:parameters]
{
  "data": {
    "h-0": "Procedure checklist",
    "0-0": "1. Import the script to your website.",
    "1-0": "2. Initialize the Smart Script object [OneLinkUrlGenerator](doc:onelinkurlgenerator) with the parameters and values.",
    "2-0": "3. [Optional] Run setters with additional parameters and values.",
    "3-0": "4. Generate the URLs."
  },
  "cols": 1,
  "rows": 4
}
[/block]
### Import the script

**To import the script to your website**: 

1. [Download the script](https://github.com/AppsFlyerSDK/appsflyer-onelink-smart-script/blob/main/v1/scripts/onelink-smart-script.js).
2. Import it into the mobile site/pages on which you want it to run. 

### Initialize the script

**To initialize the script**: 
1. Get from the marketer: The parameters/values that the outgoing OneLink URL should contain (based on what is contained in the incoming URL). See the table that follows for details.
2. Initialize the Smart Script object [`OneLinkUrlGenerator`](doc:onelinkurlgenerator) using the arguments (parameters). 
[block:parameters]
{
  "data": {
    "h-0": "Parameter",
    "h-1": "Type",
    "h-2": "Functionality",
    "h-3": "Example",
    "0-0": "oneLinkURL [required]",
    "1-0": "pidKeysList",
    "2-0": "pidOverrideList",
    "3-0": "pidStaticValue",
    "4-0": "campaignKeysList",
    "5-0": "campaignStaticValue",
    "6-0": "gclIdParam",
    "0-1": "string",
    "1-1": "List of strings",
    "2-1": "dictionary {string: string,\n…}",
    "3-1": "string",
    "4-1": "List of strings",
    "5-1": "string",
    "6-1": "string",
    "0-2": "- Serves as the base for all links generated by the script.\n- It is the OneLink template domain + template ID.",
    "0-3": "yourbrand.onelink.me/A1b2\nBranded domain example: click.yourbrand.com/A1b2",
    "1-2": "- Lists the media source parameter/s in the incoming URL that will be placed as the pid parameter in the outgoing URL.\n- If there are multiple media source params in the incoming link (for example af_pid and utm_source), the pidKeysList scans the params from first to last, and uses the first match found.",
    "2-2": "Lists the media source values in the incoming URL, alongside what you want them to be replaced with.",
    "1-3": "['af_pid', 'utm_source']",
    "4-3": "['af_campaign', 'utm_campaign']",
    "3-3": "- 'website'\n- 'landing_page'",
    "2-3": "{\n                      'twitter': 'twitter_int',\n                      'snapchat': 'snapchat_int',\n                      'some_social_net': 'some_social_net_int'\n                     }",
    "3-2": "If a pid key is not found in the pidKeysList, the pidStaticValue is used as the pid value.",
    "4-2": "Lists the campaign parameter/s in the incoming URL that will be placed as the c parameter in the outgoing URL.",
    "5-2": "If a campaign key is not found in the campaignKeysList, the campaignStaticValue is used as the c value.",
    "5-3": "- 'website'\n- 'landing_page'",
    "6-2": "- Defines which parameter in the outgoing URL carries the GCLID. \n- Any parameter can be chosen. **Note!** To display in AppsFlyer raw data reports, the param must be one of af_sub[1-5].",
    "6-3": "'af_sub5'",
    "7-0": "skipList",
    "7-1": "string",
    "7-2": "If any strings in the skip list  appear in the HTTP referrer, the Smart Script returns `null`.",
    "7-3": "- '[‘facebook’, ‘twitter’]'\n- Facebook is in the skipList by default."
  },
  "cols": 4,
  "rows": 8
}
[/block]
### Run setters

**To run setters**: 
1. Get from the marketer: Any other parameters and values that the outgoing OneLink URL should contain (based on what is contained in the incoming URL). 
2. Run the setters using the template that follows: 
[block:code]
{
  "codes": [
    {
      "code": "onelinkGenerator.set[parameter](\"parameter value\", \"optional static value\");",
      "language": "javascript"
    }
  ]
}
[/block]
For example: 
[block:code]
{
  "codes": [
    {
      "code": "onelinkGenerator.setAfSub1(\"original_url_sub1\", \"ram_afsub1\");",
      "language": "javascript"
    }
  ]
}
[/block]
### Generate URLs

**To generate outgoing OneLink URLs**: 
- Run the method generateUrl in the web/landing page HTML that calls the script.
   Possible return values are:
    - An outgoing Onelink URL
    - Null. If the script returns null, the web/landing page's existing URL is not be changed.
[block:api-header]
{
  "title": "Examples"
}
[/block]
### Basic attribution

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/basic_url.html?af_c=gogo&af_pid=email

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source'],\n         campaignKeysList: ['incoming_campaign']\n      });\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript",
      "name": null
    }
  ]
}
[/block]
**Outgoing URL**:
https://engmntqa.onelink.me/LtRd/?pid=email&c=gogo&af_js_web=true

### UTM parameters

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/utm_params.html?utm_source=email&utm_campaign=summer_sale

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "onst onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source', 'utm_source'],\n         campaignKeysList: ['incoming_campaign', 'utm_campaign']\n      });\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**:
 https://engmntqa.onelink.me/LtRd/?pid=email&c=summer_sale&af_js_web=true

###  PID and campaign static values

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/static_val.html?af_not_c=gogo&af_not_pid=email

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source'],\n         pidStaticValue: 'my_static_pid',\n         campaignKeysList: ['incoming_campaign'],\n         campaignStaticValue: 'my_static_cmpn',\n      });\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**:
https://engmntqa.onelink.me/LtRd/?pid=my_static_pid&c=my_static_cmpn&af_js_web=true

### Override PIDs

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/override_pid.html?af_pid=twitter&af_c=big_social

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source'],\n         campaignKeysList: ['incoming_campaign'],\n         pidOverrideList: { twitter: 'twitter_out',\n                            snapchat: 'snapchat_out'\n                          }\n      });\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**:
https://engmntqa.onelink.me/LtRd/?pid=twitter_out&c=big_social&af_js_web=true

### Google Click ID passthrough to af_sub

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/gclid.html?af_pid=sms&af_c=candles&gclid=1a2b3c

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source'],\n         campaignKeysList: ['incoming_campaign'],\n         gclIdParam: 'af_sub4'\n      });\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**:
https://engmntqa.onelink.me/LtRd/?pid=google_lp&c=candles&af_js_web=true&af_sub4=1a2b3c

### Set OneLink parameters
To create a long link to be used for deep linking, you can pass both custom parameters and predefined parameters. See the functions for passing parameters in the sample script that follows.  

**To pass a custom parameter:**
- Call the function `setCustomParameter`.
  The `setCustomParameter` accepts three arguments: 
        1. [Mandatory] The key in the incoming URL from which the script takes the value to set in the outgoing URL. 
        2. [Mandatory] The key to be specified in the outgoing URL.
        3. [Optional] A static fallback value, in case the key in the first argument isn’t found in the URL. 

If the key in the first argument isn’t found, and no static fallback is defined, the parameter is skipped. 

**To pass a predefined parameter**
- Call the function(s) in the sample script that follows (except `setCustomParameter`). 
Each function accepts two arguments: 
        1. [Mandatory] The key in the incoming URL from which the script takes the value to set in the outgoing URL. 
        2. [Optional] A static fallback value, in case the key in the first argument isn’t found in the URL. 

If the key in the first argument isn’t found, and no static fallback is defined, the parameter is skipped. 

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/setters.html?af_c=gogo&af_pid=email

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n        {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n         pidKeysList: ['incoming_media_source'],\n         campaignKeysList: ['incoming_campaign']\n      });\n      onelinkGenerator.setDeepLinkValue(\"original_url_deeplinkvalue\", \"yessss\");\n      onelinkGenerator.setChannel(\"original_url_channel\", \"new_channel\");\n      onelinkGenerator.setAdset(\"no_adset\", \"adset\");\n      onelinkGenerator.setAd(\"original_url_ad\", \"new_ad\");\n      onelinkGenerator.setAfSub1(\"original_url_sub1\", \"ram_afsub1\");\n      onelinkGenerator.setAfSub2(\"original_url_sub2\");\n      onelinkGenerator.setAfSub3(\"no_sub3\", \"new_afsub3\");\n      onelinkGenerator.setAfSub4(\"original_url_sub4\");\n      onelinkGenerator.setAfSub5(\"neverfind_sub5\", \"new_afsub5\");\n      onelinkGenerator.setCustomParameter(\"original_url_fruit_name\", \"onelink_my_custom_param\", \"apples\");\n      const url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**:
https://engmntqa.onelink.me/LtRd/?pid=email&c=gogo&af_js_web=true&deep_link_value=yessss&af_channel=new_channel&af_adset=adset&af_ad=new_ad&af_sub1=ram_afsub1&af_sub3=new_afsub3&af_sub5=new_afsub5&onelink_my_custom_param=apples

### Set additional attribution parameters

You can create a long link with additional attribution parameters. See the functions for passing parameters in the sample script that follows.  

**To add an attribution parameter:**
- Call the function `setCustomParameter`.
  The `setCustomParameter` accepts three arguments: 
        1. [Mandatory] The key of the attribution parameter in the incoming URL from which the script takes the value to set in the outgoing URL. 
        2. [Mandatory] The key of the attribution parameter to be specified in the outgoing URL.
        3. [Optional] A static fallback value, in case the key in the first argument isn’t found in the URL. 

If the key in the first argument isn’t found, and no static fallback is defined, the parameter is skipped. 

**Incoming URL**: 
https://appsflyersdk.github.io/appsflyer-onelink-smart-script/v1/examples/set_af_params.html?af_c=gogo&af_pid=email&partner_name=bigagency

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "onelinkGenerator.setCustomParameter(\"partner_name\", \"af_prt\", \"defaultPartner\");\nonelinkGenerator.setCustomParameter(\"incoming_site_id\", \"af_siteid\", \"defaultSiteID\");",
      "language": "javascript"
    }
  ]
}
[/block]
**Outgoing URL**: 
https://engmntqa.onelink.me/LtRd/?pid=email&c=gogo&af_js_web=true&af_prt=bigagency&af_siteid=defaultSiteID

### Skip clicks from Twitter or Facebook

You can disable the Smart Script for a particular click (for example, from Twitter or Facebook) by creating a skip list. If any of the strings in the skip list appear in the HTTP referrer of the click, the Smart Script returns `null`.

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n      {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n        pidKeysList: ['original_pid'],\n        campaignKeysList: ['original_campaign'],\n        skipList: ['twitter', 'facebook']\n    });\nconst url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]
### Don't skip any clicks

You can ensure that OneLink Smart Script works for all clicks, and never skips any, by passing an empty skip list.

**Script**:
[block:code]
{
  "codes": [
    {
      "code": "const onelinkGenerator =  new window.AF.OneLinkUrlGenerator(\n      {oneLinkURL: \"https://engmntqa.onelink.me/LtRd/\",\n        pidKeysList: ['original_pid'],\n        campaignKeysList: ['original_campaign'],\n        skipList: []\n    });\nconst url = onelinkGenerator.generateUrl();",
      "language": "javascript"
    }
  ]
}
[/block]